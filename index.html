<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åˆæ•°çˆ†ç ´Â·å¿è€…è¡ŒåŠ¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Fredoka', sans-serif;
        background-color: #e0f2fe;
        overflow: hidden;
        touch-action: none; /* Prevent pull-to-refresh on mobile */
      }
      .animate-float {
        animation: float 6s ease-in-out infinite;
      }
      .animate-float-delayed {
        animation: float 7s ease-in-out infinite;
        animation-delay: 2s;
      }
      @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-15px); }
        100% { transform: translateY(0px); }
      }
      .animate-tear {
        animation: tearDrop 1s infinite;
      }
      @keyframes tearDrop {
        0% { transform: translateY(0) scale(1); opacity: 0.8; }
        100% { transform: translateY(20px) scale(0.5); opacity: 0; }
      }
      .cloud {
        position: absolute;
        opacity: 0.8;
        z-index: 1;
        pointer-events: none;
      }
      .lawn-gradient {
        fill: url(#lawnGradient);
      }
      .lawn-gradient-back {
        fill: url(#lawnGradientBack);
      }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
      }
    }
    </script>
  <link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>
    
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef } from 'react';
      import { createRoot } from 'react-dom/client';

      // --- CONSTANTS ---
      const GAME_WIDTH = 100;
      const GAME_HEIGHT = 100;
      const GAME_DURATION = 90; 
      const PLAYABLE_HEIGHT_LIMIT = 78; // Bubbles won't go below this %

      const COLORS = [
        'bg-red-400', 'bg-orange-400', 'bg-amber-400', 'bg-green-400', 'bg-emerald-400',
        'bg-teal-400', 'bg-cyan-400', 'bg-sky-400', 'bg-blue-400', 'bg-indigo-400',
        'bg-violet-400', 'bg-purple-400', 'bg-fuchsia-400', 'bg-pink-400', 'bg-rose-400',
      ];

      const PROFESSOR_AVATAR = "ğŸ‘¨â€ğŸ«";
      const PROFESSOR_NAME = "åº“åº“æ•™æˆ";

      const Difficulty = {
        EASY: 'EASY',
        MEDIUM: 'MEDIUM',
        HARD: 'HARD'
      };

      // --- MATH SERVICE ---
      const isPrime = (num) => {
        if (num <= 1) return false;
        if (num <= 3) return true;
        if (num % 2 === 0 || num % 3 === 0) return false;
        for (let i = 5; i * i <= num; i += 6) {
          if (num % i === 0 || num % (i + 2) === 0) return false;
        }
        return true;
      };

      const getSplitFactors = (num) => {
        if (isPrime(num)) return [1, num];
        const limit = Math.floor(Math.sqrt(num));
        for (let i = limit; i > 1; i--) {
          if (num % i === 0) {
            return [i, num / i];
          }
        }
        return [1, num];
      };

      const generateNumber = (difficulty) => {
        let min = 20;
        let max = 50;
        if (difficulty === Difficulty.MEDIUM) {
          min = 50; max = 100;
        } else if (difficulty === Difficulty.HARD) {
          min = 100; max = 200;
        }
        return Math.floor(Math.random() * (max - min + 1)) + min;
      };

      // --- FEEDBACK SERVICE (STATIC - NO AI) ---
      const getProfessorFeedback = (mistakes) => {
        if (mistakes.length === 0) {
          return "å¤ªæ£’äº†ï¼ä½ æ˜¯åˆæ•°çˆ†ç ´å¤§å¸ˆï¼æ‰€æœ‰çš„è´¨æ•°éƒ½æ‰¾å¯¹äº†ï¼";
        }

        const uniqueMistakes = Array.from(new Set(mistakes)).sort((a, b) => a - b);
        return `å“å‘€ï¼ä½ é”™è¿‡äº†è¿™äº›åˆæ•°ï¼š${uniqueMistakes.join(", ")}ã€‚ä¸‹æ¬¡è¦æŠŠå®ƒä»¬æ‹†åˆ†åˆ°åº•å“¦ï¼ğŸ’¡`;
      };

      // --- COMPONENTS ---
      
      const ProfessorAssistant = ({ mistakes, visible }) => {
        if (!visible) return null;
        
        const feedback = getProfessorFeedback(mistakes);

        return (
          <div className="w-full max-w-md bg-white rounded-2xl shadow-2xl p-6 border-4 border-indigo-300 relative mt-6 animate-float">
            <div className="absolute -top-12 left-1/2 transform -translate-x-1/2 text-7xl filter drop-shadow-lg">
              {PROFESSOR_AVATAR}
            </div>
            <div className="mt-8 text-center">
              <h3 className="text-xl font-bold text-indigo-600 mb-2">{PROFESSOR_NAME}è¯´ï¼š</h3>
              <div className="bg-indigo-50 rounded-xl p-4 min-h-[100px] flex items-center justify-center">
                <p className="text-gray-700 font-medium leading-relaxed">{feedback}</p>
              </div>
            </div>
          </div>
        );
      };

      const GameCanvas = ({ gameState, onGameOver, difficulty, onWrongAction }) => {
        const requestRef = useRef(0);
        const lastTimeRef = useRef(0);
        
        const bubblesRef = useRef([]);
        const particlesRef = useRef([]);
        
        const scoreRef = useRef(0);
        const livesRef = useRef(3);
        const mistakesRef = useRef([]);
        const levelRef = useRef(1);
        const timeRef = useRef(GAME_DURATION);
        
        // Track used numbers for the session to prevent repeats
        const usedNumbersRef = useRef(new Set());

        const [renderTrigger, setRenderTrigger] = useState(0);
        const [scoreDisplay, setScoreDisplay] = useState(0);
        const [livesDisplay, setLivesDisplay] = useState(3);
        const [timeDisplay, setTimeDisplay] = useState(GAME_DURATION);
        const [message, setMessage] = useState(null);

        const popSound = useRef(null);
        const errorSound = useRef(null);
        const successSound = useRef(null);
        const bounceSound = useRef(null);

        useEffect(() => {
          popSound.current = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-bubble-pop-mechanic-3234.mp3');
          errorSound.current = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');
          successSound.current = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-game-ball-tap-2073.mp3');
          bounceSound.current = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-light-impact-on-glass-575.mp3');
          if (bounceSound.current) bounceSound.current.volume = 0.2;
        }, []);

        const playSound = (type) => {
          const sound = type === 'pop' ? popSound.current : type === 'error' ? errorSound.current : type === 'success' ? successSound.current : bounceSound.current;
          if (sound) {
            sound.currentTime = 0;
            sound.play().catch(() => {});
          }
        };

        const getRadius = (val) => 30 + Math.sqrt(val) * 8;

        const spawnInitialBubble = () => {
          let val;
          let attempts = 0;
          
          // Generate a unique number that hasn't been used yet
          // Force Composite for start (otherwise you can't split)
          do {
            val = generateNumber(difficulty);
            attempts++;
          } while ((usedNumbersRef.current.has(val) || isPrime(val)) && attempts < 50);

          // If we fail to find a unique composite after 50 tries (rare), just take any composite
          if (isPrime(val)) {
             val = val + 1; // simple hack to likely make it composite (unless val+1 is also prime, unlikely for large numbers in loop)
             if(isPrime(val)) val = val + 1;
          }

          usedNumbersRef.current.add(val);

          bubblesRef.current = [{
            id: Date.now().toString(),
            value: val,
            x: 50,
            y: 50,
            vx: (Math.random() - 0.5) * 0.4,
            vy: (Math.random() - 0.5) * 0.4,
            radius: getRadius(val),
            color: COLORS[Math.floor(Math.random() * COLORS.length)],
          }];
        };

        const createParticles = (x, y, color, count = 5) => {
          for (let i = 0; i < count; i++) {
            particlesRef.current.push({
              id: Math.random().toString(),
              value: '',
              x: x, y: y,
              vx: (Math.random() - 0.5) * 1.5,
              vy: (Math.random() - 0.5) * 1.5,
              life: 1.0,
              color: color
            });
          }
        };

        const formatTime = (seconds) => {
          const m = Math.floor(seconds / 60);
          const s = seconds % 60;
          return `${m}:${s.toString().padStart(2, '0')}`;
        };

        const handleBubbleClick = (id) => {
          if (gameState !== 'PLAYING') return;

          const index = bubblesRef.current.findIndex(b => b.id === id);
          if (index === -1) return;

          const bubble = bubblesRef.current[index];

          if (isPrime(bubble.value)) {
            playSound('bounce');
            scoreRef.current -= 1; 
            livesRef.current -= 1; // Penalize life
            
            setScoreDisplay(scoreRef.current);
            setLivesDisplay(livesRef.current);
            onWrongAction(); // Trigger Crying Sun
            
            if (livesRef.current <= 0) {
                onGameOver(scoreRef.current, mistakesRef.current);
            } else {
                setMessage({ text: "é‚£æ˜¯è´¨æ•°ï¼æ‰£1åˆ† æ‰£1å‘½", type: 'error' });
                setTimeout(() => setMessage(null), 1000);
            }
            return;
          }

          playSound('pop');
          createParticles(bubble.x, bubble.y, bubble.color);
          
          const factors = getSplitFactors(bubble.value);
          bubblesRef.current.splice(index, 1);

          const offset = 10;
          factors.forEach((f, i) => {
            bubblesRef.current.push({
              id: Date.now().toString() + i,
              value: f,
              x: bubble.x + (i === 0 ? -offset : offset),
              y: bubble.y + (Math.random() - 0.5) * offset,
              vx: (Math.random() - 0.5) * 0.8,
              vy: (Math.random() - 0.5) * 0.8,
              radius: getRadius(f),
              color: COLORS[Math.floor(Math.random() * COLORS.length)],
            });
          });
        };

        const handleVerify = () => {
          if (gameState !== 'PLAYING') return;

          const composites = bubblesRef.current.filter(b => !isPrime(b.value));

          if (composites.length === 0) {
            playSound('success');
            scoreRef.current += 2;
            levelRef.current += 1;
            
            setScoreDisplay(scoreRef.current);
            setMessage({ text: "å®Œç¾ï¼å…¨éƒ¨æ˜¯è´¨æ•°ï¼+2åˆ†", type: 'success' });
            
            // Reduced delay from 1500 to 600ms for better efficiency
            setTimeout(() => {
              setMessage(null);
              spawnInitialBubble();
            }, 600);
          } else {
            playSound('error');
            livesRef.current -= 1;
            scoreRef.current -= 2;
            onWrongAction(); // Trigger Crying Sun
            
            setLivesDisplay(livesRef.current);
            setScoreDisplay(scoreRef.current);
            
            const compositeValues = composites.map(c => c.value);
            mistakesRef.current.push(...compositeValues);
            
            if (livesRef.current <= 0) {
              onGameOver(scoreRef.current, mistakesRef.current);
            } else {
              setMessage({ text: `å“å‘€ï¼${compositeValues.join(', ')} è¿˜å¯ä»¥æ‹†åˆ†ï¼æ‰£2åˆ†`, type: 'error' });
              setTimeout(() => setMessage(null), 2000);
            }
          }
        };

        useEffect(() => {
          let interval;
          if (gameState === 'PLAYING') {
            interval = window.setInterval(() => {
              timeRef.current -= 1;
              setTimeDisplay(timeRef.current);
              if (timeRef.current <= 0) {
                clearInterval(interval);
                onGameOver(scoreRef.current, mistakesRef.current);
              }
            }, 1000);
          }
          return () => clearInterval(interval);
        }, [gameState, onGameOver]);

        const updateGame = (time) => {
          if (gameState !== 'PLAYING') return;
          lastTimeRef.current = time;

          bubblesRef.current.forEach(b => {
            b.x += b.vx;
            b.y += b.vy;
            
            // Boundary Logic with Position Clamping (Fix stuck bubbles)
            // Left Wall
            if (b.x <= 6) { 
                b.x = 6; 
                b.vx = Math.abs(b.vx); 
            }
            // Right Wall
            else if (b.x >= 94) { 
                b.x = 94; 
                b.vx = -Math.abs(b.vx); 
            }

            // Top Wall
            if (b.y <= 6) {
                b.y = 6;
                b.vy = Math.abs(b.vy);
            }
            // Bottom Limit (Lawn)
            else if (b.y >= PLAYABLE_HEIGHT_LIMIT) {
                b.y = PLAYABLE_HEIGHT_LIMIT;
                b.vy = -Math.abs(b.vy);
            }
          });

          particlesRef.current.forEach(p => {
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 0.03;
          });
          particlesRef.current = particlesRef.current.filter(p => p.life > 0);

          setRenderTrigger(prev => prev + 1);
          requestRef.current = requestAnimationFrame(updateGame);
        };

        useEffect(() => {
          if (gameState === 'PLAYING') {
            scoreRef.current = 0;
            livesRef.current = 3;
            levelRef.current = 1;
            mistakesRef.current = [];
            particlesRef.current = [];
            timeRef.current = GAME_DURATION;
            usedNumbersRef.current.clear(); // Reset used numbers on new game
            
            setScoreDisplay(0);
            setLivesDisplay(3);
            setTimeDisplay(GAME_DURATION);
            setMessage(null);
            
            spawnInitialBubble();
            requestRef.current = requestAnimationFrame(updateGame);
          }
          return () => {
            if (requestRef.current) cancelAnimationFrame(requestRef.current);
          };
        }, [gameState]);

        if (gameState !== 'PLAYING') return null;

        return (
          <div className="relative w-full h-full overflow-hidden select-none">
            {/* HUD: Lives Left */}
            <div className="absolute top-4 left-4 z-20 pointer-events-none">
              <div className="bg-white/90 backdrop-blur-sm rounded-full px-6 py-2 shadow-lg border-2 border-red-400 font-bold text-red-600 text-xl">
                ç”Ÿå‘½: {"â¤ï¸".repeat(livesDisplay)}
              </div>
            </div>

            {/* HUD: Score Right (Next to Sun) */}
            <div className="absolute top-10 right-36 z-20 pointer-events-none">
               <div className="bg-white/90 backdrop-blur-sm rounded-full px-6 py-2 shadow-lg border-2 border-orange-400 font-bold text-orange-600 text-xl w-fit">
                å¾—åˆ†: {scoreDisplay}
              </div>
            </div>
            
            {/* HUD: Timer Center */}
            <div className="absolute top-4 left-1/2 transform -translate-x-1/2 z-20 pointer-events-none">
              <div className={`bg-white/90 backdrop-blur-sm rounded-full px-8 py-2 shadow-lg border-4 font-mono text-2xl font-black ${timeDisplay < 30 ? 'border-red-500 text-red-600 animate-pulse' : 'border-gray-400 text-gray-700'}`}>
                {formatTime(timeDisplay)}
              </div>
            </div>

            {message && (
              <div className={`absolute top-1/4 left-1/2 transform -translate-x-1/2 z-30 px-8 py-4 rounded-2xl shadow-2xl text-2xl font-black animate-bounce whitespace-nowrap
                ${message.type === 'success' ? 'bg-green-500 text-white' : 
                  message.type === 'error' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white'}`}>
                {message.text}
              </div>
            )}

            <div className="absolute bottom-12 w-full flex justify-center z-20">
              <button
                onClick={handleVerify}
                className="bg-white text-green-600 text-4xl font-black py-6 px-24 rounded-full shadow-[0_8px_0_rgb(22,101,52)] active:shadow-none active:translate-y-2 transition-all hover:scale-105 tracking-widest border-4 border-green-600"
              >
                ç¡®è®¤ âœ…
              </button>
            </div>

            {bubblesRef.current.map((b) => (
              <div
                key={b.id}
                onPointerDown={(e) => {
                  e.stopPropagation();
                  handleBubbleClick(b.id);
                }}
                className={`absolute flex items-center justify-center rounded-full shadow-lg border-4 border-white/40 text-white font-black cursor-pointer transition-transform active:scale-95 hover:brightness-110 ${b.color}`}
                style={{
                  left: `${b.x}%`,
                  top: `${b.y}%`,
                  width: `${b.radius * 2}px`,
                  height: `${b.radius * 2}px`,
                  fontSize: `${Math.min(b.radius, 40)}px`,
                  transform: `translate(-50%, -50%)`,
                  boxShadow: 'inset -5px -5px 20px rgba(0,0,0,0.2)'
                }}
              >
                {b.value}
                <div className="absolute top-[15%] left-[15%] w-[30%] h-[30%] rounded-full bg-white opacity-40"></div>
              </div>
            ))}

            {particlesRef.current.map((p) => (
              <div
                key={p.id}
                className={`absolute rounded-full ${p.color}`}
                style={{
                  left: `${p.x}%`,
                  top: `${p.y}%`,
                  width: '10px',
                  height: '10px',
                  opacity: p.life,
                  transform: 'translate(-50%, -50%)',
                }}
              />
            ))}
          </div>
        );
      };

      const App = () => {
        const [gameState, setGameState] = useState('MENU');
        const [score, setScore] = useState(0);
        const [mistakes, setMistakes] = useState([]);
        const [difficulty, setDifficulty] = useState(Difficulty.EASY);
        const [isCrying, setIsCrying] = useState(false);

        const startGame = () => {
          setGameState('PLAYING');
          setMistakes([]);
          setScore(0);
        };

        const handleGameOver = (finalScore, gameMistakes) => {
          setScore(finalScore);
          setMistakes(gameMistakes);
          setGameState('GAMEOVER');
        };
        
        const triggerCrying = () => {
          setIsCrying(true);
          setTimeout(() => setIsCrying(false), 1500);
        };

        const difficultyLabel = {
          [Difficulty.EASY]: 'ç®€å•',
          [Difficulty.MEDIUM]: 'ä¸­ç­‰',
          [Difficulty.HARD]: 'å›°éš¾'
        };

        return (
          <div className="w-full h-screen bg-gradient-to-b from-sky-400 via-sky-200 to-white relative overflow-hidden flex flex-col items-center justify-center font-sans">
            
            <svg style={{ width: 0, height: 0, position: 'absolute' }} aria-hidden="true" focusable="false">
              <linearGradient id="lawnGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stopColor="#4ade80" />
                <stop offset="100%" stopColor="#166534" />
              </linearGradient>
              <linearGradient id="lawnGradientBack" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stopColor="#86efac" />
                <stop offset="100%" stopColor="#22c55e" />
              </linearGradient>
            </svg>

            {/* Cloud Background Elements */}
            <div className="cloud top-10 left-10 text-9xl text-white/40 animate-float">â˜ï¸</div>
            <div className="cloud top-24 right-20 text-8xl text-white/30 animate-float-delayed">â˜ï¸</div>
            <div className="cloud bottom-1/3 left-1/4 text-9xl text-white/20 animate-float">â˜ï¸</div>
            <div className="cloud top-10 left-1/2 text-[10rem] text-white/20 animate-float-delayed">â˜ï¸</div>

            {/* Optimized Lawn Background */}
            <div className="absolute bottom-0 w-full pointer-events-none z-10">
               {/* Back Layer Lawn */}
               <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320" className="w-full block absolute bottom-0 opacity-80" style={{height: '30vh'}} preserveAspectRatio="none">
                <path className="lawn-gradient-back" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
              </svg>
              {/* Front Layer Lawn */}
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320" className="w-full block absolute bottom-0" style={{height: '25vh'}} preserveAspectRatio="none">
                <path className="lawn-gradient" d="M0,64L48,80C96,96,192,128,288,128C384,128,480,96,576,90.7C672,85,768,107,864,128C960,149,1056,171,1152,165.3C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
              </svg>
            </div>
            
            {/* Interactive Sun Face (Top Right) */}
            <div className={`absolute top-10 right-10 w-24 h-24 bg-yellow-400 rounded-full shadow-[0_0_40px_rgba(250,204,21,0.6)] transition-all duration-300 pointer-events-none z-30
                ${isCrying ? 'scale-90 bg-yellow-300' : 'animate-pulse'}`}>
              
              {/* Left Eye */}
              <div className="absolute top-1/4 left-1/4 w-3 h-3 bg-black rounded-full transition-transform">
                 {isCrying && (
                   <div className="absolute top-full left-0 w-2 h-4 bg-blue-400 rounded-full animate-tear"></div>
                 )}
              </div>
              
              {/* Right Eye */}
              <div className="absolute top-1/4 right-1/4 w-3 h-3 bg-black rounded-full transition-transform">
                 {isCrying && (
                   <div className="absolute top-full right-0 w-2 h-4 bg-blue-400 rounded-full animate-tear" style={{animationDelay: '0.5s'}}></div>
                 )}
              </div>
              
              {/* Mouth */}
              {isCrying ? (
                // Frown
                <div className="absolute bottom-1/4 left-1/4 w-12 h-6 border-t-4 border-black rounded-full mt-2"></div>
              ) : (
                // Smile
                <div className="absolute bottom-1/4 left-1/4 w-12 h-6 border-b-4 border-black rounded-full"></div>
              )}
            </div>

            <div className="absolute inset-0 z-10">
              <GameCanvas 
                gameState={gameState} 
                onGameOver={handleGameOver} 
                difficulty={difficulty}
                onWrongAction={triggerCrying}
              />
            </div>

            {gameState === 'MENU' && (
              <div className="z-30 flex flex-col items-center bg-white/90 backdrop-blur-md p-8 rounded-3xl shadow-2xl border-4 border-sky-400 max-w-lg w-full mx-4 animate-float">
                <h1 className="text-4xl font-black text-sky-600 mb-2 drop-shadow-sm text-center tracking-tight">åˆæ•°çˆ†ç ´</h1>
                <h2 className="text-3xl font-bold text-orange-500 mb-6 tracking-wide">å¿è€…è¡ŒåŠ¨</h2>
                
                <div className="flex gap-4 mb-6 text-6xl">
                  <span>ğŸ¥·</span>
                  <span>ğŸ«§</span>
                  <span>{PROFESSOR_AVATAR}</span>
                </div>

                <div className="text-gray-600 text-center mb-6 text-lg leading-relaxed bg-sky-50 p-4 rounded-xl border border-sky-200">
                  <p className="mb-2">1. ç‚¹å‡» <span className="font-bold text-red-500">åˆæ•°æ³¡æ³¡</span> å°†å…¶æ‹†åˆ†</p>
                  <p className="mb-2">2. ä¸è¦ç‚¹å‡» <span className="font-bold text-green-600">è´¨æ•°</span> (ä¼šæ‰£åˆ†å“¦!)</p>
                  <p>3. å‰©ä¸‹çš„å…¨æ˜¯è´¨æ•°æ—¶ç‚¹å‡» <span className="font-bold bg-green-500 text-white px-2 py-0.5 rounded-md text-sm">ç¡®è®¤</span></p>
                </div>

                <div className="flex gap-2 mb-6 w-full justify-center">
                   {['EASY', 'MEDIUM', 'HARD'].map((level) => (
                      <button
                        key={level}
                        onClick={() => setDifficulty(Difficulty[level])}
                        className={`px-4 py-2 rounded-xl font-bold transition-all ${difficulty === Difficulty[level] ? 'bg-sky-500 text-white scale-110 shadow-lg' : 'bg-gray-200 text-gray-500 hover:bg-gray-300'}`}
                      >
                        {difficultyLabel[Difficulty[level]]}
                      </button>
                   ))}
                </div>

                <button
                  onClick={startGame}
                  className="w-full bg-gradient-to-r from-green-400 to-green-600 text-white text-3xl font-black py-4 rounded-2xl shadow-xl hover:scale-105 active:scale-95 transition-transform border-b-8 border-green-700"
                >
                  å¼€å§‹æ¸¸æˆ
                </button>
              </div>
            )}

            {gameState === 'GAMEOVER' && (
              <div className="z-30 flex flex-col items-center max-w-2xl w-full mx-4">
                <div className="bg-white/95 backdrop-blur-md p-8 rounded-3xl shadow-2xl border-4 border-red-400 w-full flex flex-col items-center">
                  <h2 className="text-4xl font-black text-gray-800 mb-2">æ¸¸æˆç»“æŸ!</h2>
                  <div className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-600 mb-6">
                    æœ€ç»ˆå¾—åˆ†: {score}
                  </div>

                  <ProfessorAssistant mistakes={mistakes} visible={true} />

                  <button
                    onClick={() => setGameState('MENU')}
                    className="mt-8 bg-sky-500 text-white text-xl font-bold py-3 px-12 rounded-full shadow-lg hover:bg-sky-600 transition-colors"
                  >
                    å†ç©ä¸€æ¬¡
                  </button>
                </div>
              </div>
            )}

          </div>
        );
      }

      const container = document.getElementById("root");
      const root = createRoot(container);
      root.render(<App />);
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>